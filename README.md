# Light Watcher
## Телеграм бот на esp32 для пінгування світла.

<!-- Тут буде посилання на ютуб відео -->

# Опис:
Телеграм бот який сповіщає про наявність зникнення та появу електромережі з точністю до хвилини, вміє синхронізуватись з реальним часом та збирає мінімальну статистику.

# Особливості:
- Рахує точну кількість часу впробовж якого світло було відсутнє
- Має захист від розряду батареї
    - Таким чином якщо світло пропало та заряду батареї не вистачило, бот всерівно сповістить про появу світла, та підрахує час скільки його не було, одразу коли воно з'явиться
  
- Безперебійне живлення для ESP32
    - Якщо електромережа пропадає, ESP32 одразу переходить на живлення від акумулятору без перезавантаження
  
- Можливість юота писати та отримувати повідомлення з загальниг груп, щоб сповістити максимальну кількість людей
- Надійне з'єднання з WiFi
    - ESP32 перевіряє наявність WiFi мережі кожних 30 секунд, якщо вона відсутня мікроконтролер пробує реконектитись, так забезпечується надійніше з'єднання з мережею
- Зручний та компактний 3Д друкований корпус для пристрою

# Приклад як це виглядає у Telegram:

<p align="lef">
  <img src="Images/Photos/Photo_5.jpg" alt="Circuit_Image" height="600">
  <img src="Images/Photos/Photo_6.jpg" alt="Circuit_Image" height="600">
</p>

## Список команд для бота:
```
/info - Про бота
/status - Стан системи
/set_summer_time - Встановити літній час
/set_winter_time - Встановити зимовий час
/clear_data  - Очистити статистику
/restart - Віддалений перезапуск бота
```

Також бот вміє реагувати на запитання: "Світло є чи нема?"

# Налаштування Telegram Бота та групи:
1. Створіть бота у Телеграмі за допомогою [`BotFather`](https://ukr-bot.com/yak-stvoryty-telehram-bota-cherez-botfather/) (Також збережіть отриманий токен для вашого бота)
   
2. Налаштуйте команди для бота, Edit Bot -> Edit Commands -> Вставте заготовлений текст:
    ```
    /info - Про бота
    /status - Стан системи
    /set_summer_time - Встановити літній час
    /set_winter_time - Встановити зимовий час
    /clear_data  - Очистити статистику
    /restart - Віддалений перезапуск бота
    ```

3. Якщо ви плануєте також додати бота у групу для сповіщення, тоді зайдіть у Bot settings та дайте йому дозвіл писати у загальні групи натиснувши "Allow Groups?"
   
4. Додайте бота у групу та зробіть його адміністратором щоб він міг надсилати повідомлення
   
5. Дізнайтеся свій ChatID та ChatID групи доприкладу за допомогою бота: myIDBot

# Cхема:
<img src="Images/Circuit_image.png" alt="Circuit_Image" width="100%">

# Код:

### Вихідний код знаходиться у репозиторії за таким шляхом: [`Light_Watcher_Firmware_V1.0/Light_Watcher_Firmware_V1.0.ino`](Light_Watcher_Firmware_V1.0/Light_Watcher_Firmware_V1.0.ino)

Завантажте цей файл або просто скопіюйте у вже існуючому .ino файл у себе на комп'ютері(Важливо завантажений ino. файл потрібно помістити у папку з таким самим іменем).

Також у Arduino IDE вам потрібно завантажити ядро для роботи з платами esp32:   
[`esp32 by Espressif Systems`](https://github.com/espressif/arduino-esp32/releases/latest) _(або через Board Manager)_

Та 1 додаткову бібліотеку:  
[`UniversalTelegramBot`](https://github.com/witnessmenow/Universal-Arduino-Telegram-Bot/releases/latest) _(або через Library Manager)_

Перед завантаженням прошивки замініть значення у цих рядках в коді на ваші:
```
const char* ssid = " "; // Назва домашньої WiFi мережі
const char* password = " "; // Пароль домашньої WiFi мережі
const char* botToken = " "; // Токен бота
const char* chatId = " "; // ChatID Власника бота
const char* groupId = " "; // ChatID Загальної групи
```

# Корпус:
Змоделював корпус для того щоб зручно умістити та заховати у ньому всі компоненти:

<img src="Images/Photos/Photo_7.jpg" alt="Circuit_Image" width="100%">
<img src="Images/Photos/Photo_8.jpg" alt="Circuit_Image" width="80%">
<img src="Images/Photos/Photo_9.jpg" alt="Circuit_Image" width="100%">

### STL Файли для друку:  [`STL Models`](STL%20Models)
### CAD Файл (Fusion) для редагування:  [`CAD File/Main.f3z`](CAD%20File/Main.f3z)

# Необхідні компоненти:
<img src="Images/Photos/Photo_1.JPG" alt="Circuit_Image" width="100%">

| НОМЕР | НАЗВА | КІЛЬКІСТЬ |
| :---: | :---: | :--: |
| 1 | [Мікроконтролер ESP32 C3 SuperMini](https://tinyurl.com/4h6e2k6n) | 1шт |
| 2 | [Підвищуючий dc-dc перетворювач CKCS BS01](https://tinyurl.com/34p7wcya) | 1шт |
| 3 | [Плата заряду TP4056](https://tinyurl.com/2sxvzadh) | 1шт |
| 4 | Діоди Шотткі 1N5819 | 2шт |
| 5 | Резистор 10kOm | 1шт |
| 6 | Резистор 20kOm | 1шт |
| 7 | [Перемикач KCD11](https://tinyurl.com/mryyff8m) | 1шт |
| 8 | [Холдер для 18650}](https://tinyurl.com/mjyb3htm) | 1шт |
| 9 | Акумулятор 18650 ємністю > 1000mAh | 1шт |
